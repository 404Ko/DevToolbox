@page "/other/radix"
@inject DevToolbox.Web.Services.IOtherToolService ToolService

<PageTitle>è¿›åˆ¶è½¬æ¢ - DevToolbox</PageTitle>

@* AI Accept [Added]: Radix converter tool page *@
<div class="tool-page">
    <div class="tool-header">
        <h1>ğŸ”¢ è¿›åˆ¶è½¬æ¢</h1>
        <p>åœ¨äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åè¿›åˆ¶ã€åå…­è¿›åˆ¶ä¹‹é—´å¿«é€Ÿè½¬æ¢ï¼Œæ”¯æŒ 0x/0b/0o å‰ç¼€</p>
    </div>

    @* AI Accept [Added]: Input section *@
    <div class="card">
        <div class="card-header">
            <span>ğŸ“¥ è¾“å…¥</span>
        </div>
        <div class="card-body">
            <div class="options-row" style="margin-bottom: 12px;">
                <div class="option-item">
                    <label>è¾“å…¥è¿›åˆ¶ï¼š</label>
                    <select class="form-control" style="width: auto;" @bind="FromBase">
                        <option value="2">äºŒè¿›åˆ¶ (Base-2)</option>
                        <option value="8">å…«è¿›åˆ¶ (Base-8)</option>
                        <option value="10">åè¿›åˆ¶ (Base-10)</option>
                        <option value="16">åå…­è¿›åˆ¶ (Base-16)</option>
                    </select>
                </div>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" class="form-control" style="font-family: 'Consolas', monospace; font-size: 16px;"
                       placeholder="@GetPlaceholder()"
                       @bind="InputValue" @bind:event="oninput" />
            </div>
        </div>
    </div>

    <div class="btn-group" style="margin-top: 20px; justify-content: center;">
        <button class="btn btn-primary" @onclick="Convert">ğŸ”„ è½¬æ¢</button>
        <button class="btn btn-secondary" @onclick="Clear">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    @if (!string.IsNullOrEmpty(Result?.ErrorMessage))
    {
        <div class="alert alert-danger">@Result.ErrorMessage</div>
    }

    @* AI Accept [Added]: Conversion results *@
    @if (Result is { Success: true })
    {
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <span>ğŸ“Š è½¬æ¢ç»“æœ</span>
            </div>
            <div class="card-body">
                <div class="radix-result-grid">
                    <div class="radix-result-item">
                        <div class="radix-label">äºŒè¿›åˆ¶ (BIN)</div>
                        <div class="radix-value">
                            <code>0b@FormatBinary(Result.Binary)</code>
                        </div>
                    </div>
                    <div class="radix-result-item">
                        <div class="radix-label">å…«è¿›åˆ¶ (OCT)</div>
                        <div class="radix-value">
                            <code>0o@Result.Octal</code>
                        </div>
                    </div>
                    <div class="radix-result-item">
                        <div class="radix-label">åè¿›åˆ¶ (DEC)</div>
                        <div class="radix-value">
                            <code>@Result.Decimal</code>
                        </div>
                    </div>
                    <div class="radix-result-item">
                        <div class="radix-label">åå…­è¿›åˆ¶ (HEX)</div>
                        <div class="radix-value">
                            <code>0x@Result.Hex</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    @* AI Accept [Added]: Quick reference *@
    <div class="card" style="margin-top: 20px;">
        <div class="card-header">
            <span>ğŸ“‹ å¸¸ç”¨å€¼é€ŸæŸ¥</span>
        </div>
        <div class="card-body">
            <table class="jwt-claims-table">
                <thead>
                    <tr>
                        <th>DEC</th>
                        <th>HEX</th>
                        <th>OCT</th>
                        <th>BIN</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>255</td><td>FF</td><td>377</td><td>11111111</td><td>1 byte max</td></tr>
                    <tr><td>256</td><td>100</td><td>400</td><td>100000000</td><td>2â¸</td></tr>
                    <tr><td>1024</td><td>400</td><td>2000</td><td>10000000000</td><td>1 KB</td></tr>
                    <tr><td>65535</td><td>FFFF</td><td>177777</td><td>1111111111111111</td><td>2 bytes max</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@code {
    // AI Accept [Added]: Radix converter page state
    private string InputValue { get; set; } = string.Empty;
    private int FromBase { get; set; } = 10;
    private DevToolbox.Web.Services.RadixConvertResult? Result { get; set; }

    private void Convert()
    {
        if (string.IsNullOrWhiteSpace(InputValue))
        {
            Result = new DevToolbox.Web.Services.RadixConvertResult { ErrorMessage = "è¯·è¾“å…¥æ•°å€¼" };
            return;
        }
        Result = ToolService.ConvertRadix(InputValue, FromBase);
    }

    private string GetPlaceholder() => FromBase switch
    {
        2 => "ä¾‹å¦‚: 10110101 æˆ– 0b10110101",
        8 => "ä¾‹å¦‚: 377 æˆ– 0o377",
        16 => "ä¾‹å¦‚: FF æˆ– 0xFF",
        _ => "ä¾‹å¦‚: 255"
    };

    /// <summary>
    /// Format binary with 4-bit grouping for readability (AI Accept)
    /// </summary>
    private string FormatBinary(string bin)
    {
        if (bin.Length <= 4) return bin;
        // Pad to multiple of 4
        var padded = bin.PadLeft((int)Math.Ceiling(bin.Length / 4.0) * 4, '0');
        var groups = new List<string>();
        for (int i = 0; i < padded.Length; i += 4)
            groups.Add(padded.Substring(i, 4));
        return string.Join(" ", groups);
    }

    private void Clear()
    {
        InputValue = string.Empty;
        Result = null;
    }
}
