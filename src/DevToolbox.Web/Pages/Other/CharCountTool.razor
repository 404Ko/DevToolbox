@page "/other/char-count"
@inject DevToolbox.Web.Services.IOtherToolService ToolService

<PageTitle>å­—ç¬¦ç»Ÿè®¡ - DevToolbox</PageTitle>

@* AI Accept [Added]: Character statistics tool page *@
<div class="tool-page">
    <div class="tool-header">
        <h1>ğŸ“Š å­—ç¬¦ç»Ÿè®¡</h1>
        <p>ç»Ÿè®¡æ–‡æœ¬å­—ç¬¦æ•°ã€å•è¯æ•°ã€è¡Œæ•°ã€å­—èŠ‚å¤§å°ã€å­—ç¬¦é¢‘ç‡åˆ†å¸ƒ</p>
    </div>

    @* AI Accept [Added]: Input card *@
    <div class="card">
        <div class="card-header">
            <span>ğŸ“ è¾“å…¥æ–‡æœ¬</span>
            @if (Stats != null)
            {
                <span style="font-size: 12px; color: var(--text-secondary);">
                    @Stats.TotalChars å­—ç¬¦ Â· @Stats.WordCount è¯ Â· @Stats.LineCount è¡Œ
                </span>
            }
        </div>
        <div class="card-body">
            <textarea class="form-control" rows="8" style="min-height: 160px;"
                      placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´æ–‡æœ¬..."
                      @bind="InputText" @bind:event="oninput"
                      @onfocus="Analyze" @onblur="Analyze"></textarea>
            <div class="btn-group" style="margin-top: 12px;">
                <button class="btn btn-primary" @onclick="Analyze">ğŸ“Š ç»Ÿè®¡åˆ†æ</button>
                <button class="btn btn-secondary" @onclick="Clear">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-secondary" @onclick="LoadSample">ğŸ“‹ åŠ è½½ç¤ºä¾‹</button>
            </div>
        </div>
    </div>

    @* AI Accept [Added]: Statistics results *@
    @if (Stats != null && Stats.TotalChars > 0)
    {
        @* AI Accept [Added]: Overview stats cards *@
        <div class="char-stats-grid" style="margin-top: 20px;">
            <div class="char-stat-card">
                <div class="char-stat-num">@Stats.TotalChars</div>
                <div class="char-stat-label">æ€»å­—ç¬¦æ•°</div>
            </div>
            <div class="char-stat-card">
                <div class="char-stat-num">@Stats.TotalCharsNoSpaces</div>
                <div class="char-stat-label">å­—ç¬¦(ä¸å«ç©ºæ ¼)</div>
            </div>
            <div class="char-stat-card">
                <div class="char-stat-num">@Stats.WordCount</div>
                <div class="char-stat-label">å•è¯/è¯è¯­</div>
            </div>
            <div class="char-stat-card">
                <div class="char-stat-num">@Stats.LineCount</div>
                <div class="char-stat-label">è¡Œæ•°</div>
            </div>
            <div class="char-stat-card">
                <div class="char-stat-num">@FormatBytes(Stats.ByteCountUtf8)</div>
                <div class="char-stat-label">UTF-8 å¤§å°</div>
            </div>
            <div class="char-stat-card">
                <div class="char-stat-num">@Stats.ChineseCount</div>
                <div class="char-stat-label">ä¸­æ–‡å­—ç¬¦</div>
            </div>
        </div>

        @* AI Accept [Added]: Detailed breakdown *@
        <div class="tool-content" style="margin-top: 20px;">
            <div class="card">
                <div class="card-header">
                    <span>ğŸ“‹ å­—ç¬¦åˆ†ç±»</span>
                </div>
                <div class="card-body">
                    <table class="jwt-claims-table">
                        <thead>
                            <tr>
                                <th>ç±»å‹</th>
                                <th>æ•°é‡</th>
                                <th>å æ¯”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å­—æ¯</td>
                                <td><code>@Stats.LetterCount</code></td>
                                <td>@Pct(Stats.LetterCount)</td>
                            </tr>
                            <tr>
                                <td>æ•°å­—</td>
                                <td><code>@Stats.DigitCount</code></td>
                                <td>@Pct(Stats.DigitCount)</td>
                            </tr>
                            <tr>
                                <td>ä¸­æ–‡</td>
                                <td><code>@Stats.ChineseCount</code></td>
                                <td>@Pct(Stats.ChineseCount)</td>
                            </tr>
                            <tr>
                                <td>ç©ºæ ¼</td>
                                <td><code>@Stats.SpaceCount</code></td>
                                <td>@Pct(Stats.SpaceCount)</td>
                            </tr>
                            <tr>
                                <td>æ ‡ç‚¹ç¬¦å·</td>
                                <td><code>@Stats.PunctuationCount</code></td>
                                <td>@Pct(Stats.PunctuationCount)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            @* AI Accept [Added]: Character frequency table *@
            <div class="card">
                <div class="card-header">
                    <span>ğŸ”¤ å­—ç¬¦é¢‘ç‡ (Top 30)</span>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    @if (Stats.TopFrequencies.Any())
                    {
                        <table class="jwt-claims-table">
                            <thead>
                                <tr>
                                    <th style="width: 60px;">å­—ç¬¦</th>
                                    <th style="width: 60px;">æ¬¡æ•°</th>
                                    <th style="width: 60px;">å æ¯”</th>
                                    <th>åˆ†å¸ƒ</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var f in Stats.TopFrequencies)
                                {
                                    <tr>
                                        <td><code style="font-size: 14px;">@f.Char</code></td>
                                        <td>@f.Count</td>
                                        <td>@f.Percent%</td>
                                        <td>
                                            <div class="char-freq-bar">
                                                <div class="char-freq-fill" style="width: @(Math.Min(f.Percent * 3, 100))%;"></div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>
    }
</div>

@code {
    // AI Accept [Added]: Character statistics page state
    private string InputText { get; set; } = string.Empty;
    private DevToolbox.Web.Services.CharStatsResult? Stats { get; set; }

    private void Analyze()
    {
        if (!string.IsNullOrEmpty(InputText))
        {
            Stats = ToolService.GetCharStats(InputText);
        }
    }

    private void LoadSample()
    {
        InputText = "Hello World! ä½ å¥½ä¸–ç•Œï¼\nThis is a sample text with 123 numbers.\nè¿™æ˜¯ä¸€æ®µåŒ…å«ä¸­è‹±æ–‡æ··åˆçš„æµ‹è¯•æ–‡æœ¬ï¼Œç”¨äºéªŒè¯å­—ç¬¦ç»Ÿè®¡åŠŸèƒ½ã€‚\nSpecial chars: @@#$%^&*()";
        Analyze();
    }

    private void Clear()
    {
        InputText = string.Empty;
        Stats = null;
    }

    /// <summary>
    /// Calculate percentage string (AI Accept)
    /// </summary>
    private string Pct(int count)
    {
        if (Stats == null || Stats.TotalChars == 0) return "0%";
        return $"{(count * 100.0 / Stats.TotalChars):F1}%";
    }

    /// <summary>
    /// Format bytes to human readable (AI Accept)
    /// </summary>
    private string FormatBytes(int bytes)
    {
        if (bytes >= 1048576) return $"{bytes / 1048576.0:F1} MB";
        if (bytes >= 1024) return $"{bytes / 1024.0:F1} KB";
        return $"{bytes} B";
    }
}
